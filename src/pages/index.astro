---
// Homepage for Kentucky Geological Survey
import Header from '../components/common/Header.astro';
import Footer from '../components/common/Footer.astro';
import NewsGrid from '../components/news/NewsGrid.astro';
import { fetchRecentNews } from '../lib/api_news';
import { fetchHomepageSection } from '../lib/api_homepage';

import '../styles/home_global.css';
import '../styles/home_reset.css';
import '../styles/home_styles.css';

// Fetch recent news for the homepage (limit to 6 items)
const { articles } = await fetchRecentNews(6, 1);

// Fetch the internship section data
const dynamicSection = await fetchHomepageSection();

// Fallback data for the internship section if no CMS data is available
const fallbackDynamicData = {
    title: "Summer Internship Program",
    content: `<p>Dr. Paul Edwin Potter Internship Program participants collaborate with mentors from KGS on 10-week research projects focused on KGS current research areas. Interns develop technical skills, participate in professional development opportunities, and expand their academic networks.</p>`,
    button_text: "Find Out More",
    button_url: "/intern/",
    image: null, // Will use hardcoded image path below
    image_alt_text: "2023 Potter Internship Program participants",
    image_caption: "2023 Potter Internship Program participants"
};
---
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7XRH6W5VTY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7XRH6W5VTY');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kentucky Geological Survey, University of Kentucky">
    <title>Kentucky Geological Survey, University of Kentucky</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/bb3bef310a.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Use your Astro Header component -->
    <Header activePage="home" />

 <main>
        <!-- Video Background -->
        <section class="hero">
            <div class="hero-container">
                <div class="video-container">
                    <div class="link-container">
                        
                        <a class="hero-link inter-nav" href="/staff/">
                                <img src="/assets/index/cropped-community.png" alt="Community">
                                <span class="link-text">People</span>
                                <div class="rollover-active">
                                    <h3 class="inter-h3">People</h3>
                                    <p class="source-sans-3-p rollover-text">Expert geologists, researchers, and support staff specializing in landslide monitoring, hydrogeology, mineral resources, and environmental geology.</p>
                                </div>
                        </a>

                        <a class="hero-link inter-nav" href="/labs/">
                          <img src="/assets/index/cropped-energy.png" alt="Labs">
                            <span class="link-text">Labs</span>
                            <div class="rollover-active">
                                <h3 class="inter-h3">Labs</h3>
                                <p class="source-sans-3-p rollover-text">State-of-the-art research facilities providing geochemical analysis, materials testing, and hazard assessments for geological research and environmental monitoring across Kentucky.</p>
                            </div>
                            </a>

                            <a class="hero-link inter-nav" href="/monitoring">
                                <img src="/assets/index/cropped-water.png" alt="Water">
                                <span class="link-text">Monitoring</span>
                                <div class="rollover-active">
                                    <h3 class="inter-h3">Monitoring</h3>
                                    <p class="source-sans-3-p rollover-text">Real-time monitoring of groundwater, seismic activity, landslides, and environmental conditions to protect communities and infrastructure across Kentucky.</p>
                                </div>
                            </a>

                            <a class="hero-link inter-nav" href="/news/">
                                <img src="/assets/index/bullhorn-regular-full.svg" alt="News" class="hero-icon">
                                <span class="link-text">News & Events</span>
                                <div class="rollover-active">
                                    <h3 class="inter-h3">News & Events</h3>
                                    <p class="source-sans-3-p rollover-text">Latest KGS research findings, field studies, publications, and community outreach helping Kentucky understand and prepare for geological hazards.</p>
                                </div>
                            </a>
                    </div>
                    <div class="video-copy-container">
                        <h2 class="hero-title inter-h2">Kentucky Geological Survey</h2>
                        <h1 class="hero-subtitle inter-h1">Understanding Earth's Resources for our Commonwealth</h1>
                    </div>
                    <video 
                        id="hero-video"
                        class="video" 
                        src="/assets/index/video-icon-background.mp4" 
                        loop 
                        autoplay 
                        muted
                        aria-label="Background video showing geological research"
                    ></video>

                    <!-- Subtle Video Controls with Font Awesome -->
                    <button 
                        id="video-control-btn"
                        class="video-control-button"
                        aria-label="Pause background video"
                        aria-pressed="false"
                        title="Pause/Play video"
                    >
                        <i class="fa-solid fa-play control-icon play-icon" aria-hidden="true"></i>
                        <i class="fa-solid fa-pause control-icon pause-icon" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </section>

        <section class="section-tile">
            <div class="section-container">
                <div class="tile-heading">
                    <h2 class="inter-h2">Who We Are</h2>
                    <p class="source-sans-3-p-bigger-bolder">The Kentucky Geological Survey (KGS) is a state-supported research center and public resource within the University of Kentucky. Our mission is to support the sustainable prosperity of the Commonwealth, the vitality of its flagship land grant university, and the welfare of its people. We do this by conducting research in the geological sciences, providing unbiased data and information to the public, and engaging with stakeholders. Research conducted by the KGS serves the Commonwealth and its people by building resilience.</p>
                </div>
                <div class="tile-container">
                    <!-- Make tiles clickable buttons by converting to anchor tags -->
                    <a href="https://www.uky.edu/KGS/education/" class="tile community">
                        <div class="tile-content">
                            <h2 class="inter-h2 tile-title">Community &amp; Education</h2>
                            <p class="source-sans-3-p tile-text">Discover comprehensive geological educational resources tailored for K-16 educators and students.</p>
                        </div>
                    </a>
                    <a href="/labs/" class="tile research">
                        <div class="tile-content">
                            <h2 class="inter-h2 tile-title">Research &amp; Labs</h2>
                            <p class="source-sans-3-p tile-text">Our research and laboratories enhance knowledge and understanding of Kentucky's geological resources, hazards, and water systems to support science-based decision making for the Commonwealth.</p>
                        </div>
                    </a>
                    <a href="/about/jobs/" class="tile openings">
                        <div class="tile-content">
                            <h2 class="inter-h2 tile-title">Current Openings</h2>
                            <p class="source-sans-3-p tile-text">Check out our current job opportunities and apply today.</p>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <section class="midsection">
            <div class="section-container">
             <!-- Dynamic Internship/First Section -->
            <div class="section-dynamic">
                <h2 class="inter-h2">{dynamicSection?.title || fallbackDynamicData.title}</h2>
                
                <!-- Content with HTML support -->
                <div class="section-content" set:html={dynamicSection?.content || fallbackDynamicData.content} />
                
                <!-- Button - aligned left -->
                <div class="button-container-left">
                    <a href={dynamicSection?.button_url || fallbackDynamicData.button_url} class="inter-button">
                        {dynamicSection?.button_text || fallbackDynamicData.button_text}
                    </a>
                </div>
                
                <!-- Image - centered with left-aligned caption -->
                {dynamicSection?.image ? (
                    <div class="image-container-centered">
                        <img 
                            src={`${import.meta.env.PUBLIC_DIRECTUS_URL}assets/${dynamicSection.image}?quality=90&width=600&fit=cover`} 
                            alt={dynamicSection.image_alt_text || ''} 
                        />
                        {dynamicSection.image_caption && (
                            <p class="image-caption-left source-sans-3-p-smaller">{dynamicSection.image_caption}</p>
                        )}
                    </div>
                ) : (
                    <div class="image-container-centered">
                        <img src="/assets/index/kgs-internship-sm.webp" alt="2023 Potter Internship Program participants">
                        <p class="image-caption-left source-sans-3-p-smaller">2023 Potter Internship Program participants</p>
                    </div>
                )}
            </div>
                            
                <div class="section-connect">
                    <h2 class="inter-h2">Connect with Us</h2>

                    <!-- Podcast Section -->
                    <div class="connect-item podcast">
                        <h3 class="inter-h2 connect-subtitle">The Big Blue Rock Pod</h3>
                        <p class="source-sans-3-p">This podcast is a fun, conversational approach to discussing all things geology and earth processes.
                            We primarily focus on Kentucky as we talk about emerging ideas in research, along with classic topics in earth science for all levels of interest.</p>
                        <div class="podcast-player">
                            <iframe title="The Big Blue Rock Pod" allowtransparency="true" height="260" width="100%" style="border: none; min-width: min(100%, 430px);height:260px;" scrolling="no" data-name="pb-iframe-player" src="https://www.podbean.com/player-v2/?i=d94fw-cf37a4-pbblog-playlist&share=0&download=1&rtl=0&fonts=Verdana&skin=3267a3&font-color=auto&logo_link=episode_page&order=episodic&limit=3&filter=all&ss=8d19f7d7d2764f3305b6868e1e1efb88&btn-skin=60a0c8&size=260" loading="lazy" allowfullscreen=""></iframe>
                        </div>
                    </div>

                        <!-- Social Media Section - Left Column -->
                        <div class="connect-item social">
                            <h3 class="inter-h2 connect-subtitle">Follow Our Research</h3>
                            <p class="source-sans-3-p">Stay connected with KGS on social media for updates, research highlights, and community engagement.</p>
                            <div class="social-links">
                                <a href="https://www.facebook.com/kgsnews/" class="social-link" target="_blank" rel="noopener" aria-label="Follow us on Facebook">
                                    <img src="/assets/index/facebook.svg" alt="Facebook">
                                </a>
                                <a href="https://www.linkedin.com/company/kgsnews" class="social-link" target="_blank" rel="noopener" aria-label="Follow us on LinkedIn">
                                    <img src="/assets/index/linkedin.svg" alt="LinkedIn">
                                </a>
                                <a href="https://www.instagram.com/kygeologicalsurvey/" class="social-link" target="_blank" rel="noopener" aria-label="Follow us on Instagram">
                                    <i class="fab fa-instagram text-2xl text-white"></i>
                                </a>
                                <a href="https://www.youtube.com/user/KGSUK" class="social-link" target="_blank" rel="noopener" aria-label="Subscribe to our YouTube channel">
                                    <img src="/assets/index/youtube.svg" alt="YouTube">
                                </a>
                                <a href="https://twitter.com/KGSNews" class="social-link" target="_blank" rel="noopener" aria-label="Follow us on Twitter/X">
                                    <img src="/assets/index/x-twitter.svg" alt="X/Twitter">
                                </a>
                            </div>
                        </div>
                </div>
        </section>

        <!-- Ask a Geologist Section - Full Width -->
        <section class="section-ask-geologist">
            <div class="ask-geologist-full">
                <div class="section-container">
                    <div class="ask-geologist-container">
                        <div class="ask-geologist-content">
                            <h2 class="inter-h2">Ask a Geologist</h2>
                            <p class="source-sans-3-p ask-geologist-intro">Have questions about Kentucky's geology? Wondering about rocks, minerals, landslides, or groundwater in your area? Our expert geologists are here to help with answers backed by decades of research and field experience.</p>
                            
                            <div class="email-contact-container">
                                <div class="email-contact-card">
                                    <div class="email-icon">
                                        <!-- Font Awesome question icon -->
                                        <i class="fas fa-question" aria-hidden="true"></i>
                                    </div>
                                    <div class="email-content">
                                        <a href="mailto:kgsmail@uky.edu?subject=Geology Question" class="email-link inter-button">
                                            Ask Our Experts
                                        </a>
                                        <p class="email-description source-sans-3-p">
                                            Send your geology questions to <strong><a href="mailto:kgsmail@uky.edu?subject=Geology Question" aria-label="Email KGS" class="baselink">kgsmail@uky.edu</a></strong>. Please include the topic in your subject line. 
                                            For specimen identification (fossils, rocks, minerals), include a high-quality (at least 150 dpi), in-focus photo with an item next to the specimen for 
                                            scale (ruler, coin, etc.). If possible, please also provide at least the county-level location where you found the specimen. 
                                            <br><br>
                                            <strong>Please note:</strong> KGS staff and researchers cannot perform land surveying, consulting services, or referrals. 
                                            You can find a list of licensed geologists in Kentucky through the Kentucky Board of Registration for Professional Geologists: 
                                            <a href="https://bpg.ky.gov/" target="_blank" rel="noopener" class="baselink" aria-label="Kentucky Board of Registration for Professional Geologists">bpg.ky.gov</a>.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Image column - will be hidden on mobile via CSS -->
                        <div class="ask-geologist-image" role="img" aria-label="Kentucky geologist examining rock formations in the field"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section-tile service-section">
            <div class="tile-container service-full-width">
                <div class="tile service">
                    <div class="service-inner-container">
                        <div class="service-container">
                            <h2 class="inter-h2">How KGS Serves Our Kentucky Community</h2>
                            <p class="source-sans-3-p">The Kentucky Geological Survey (KGS) traces its roots back to 1838 and has been part of the University of Kentucky since 1948. Our mission is to support the sustainable prosperity of the Commonwealth, the vitality of its flagship university, and the welfare of its people.</p>
                            <p class="source-sans-3-p">We do this by conducting research and providing unbiased information about the geology and natural resources of Kentucky. We focus on issues relevant to the economic prosperity, environmental quality, and practical well-being of the Commonwealth and its people: the things that can make Kentucky a compelling place to live, work, and do business.</p>
                            <p class="source-sans-3-p">KGS provides technical support to several state agencies and organizations, as well as a host of local, county, and federal agencies. We also interact with stakeholders from a wide range of community, industry, environmental, and educational groups, and the KGS website provides free public access to our databases, digital map layers, and reports.</p>
                        
                            <a href="/about/" class="inter-button transparent service-button">Learn more</a>
                        </div>
                        <div class="youtube-video-container">
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/yIvYDxurai4?si=ZIGOG3YK43cEIIxQ" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section-data">
            <div class="section-container">
                <div class="data-container">
                    <h2 class="inter-h2">Gateway to Kentucky's Earth Science Data</h2>
                    <p class="source-sans-3-p">The Kentucky Geological Survey provides free public access to comprehensive databases, digital maps, and research reports through user-friendly interactive interfaces—no specialized software required.</p>
                    <br>
                    <p class="source-sans-3-p">Our Earth Analysis Research Library houses over 2,500 rock cores, 16,000 oil/gas well samples, 8,000 limestone samples, and 5,000 coal samples. The KGS Groundwater Data Repository contains information on over 92,000 water wells, 5,100 springs, and 58,000 water-quality analyses.</p>
                    <br>
                    <p class="source-sans-3-p">Additional databases document Kentucky's landslides, sinkholes, oil and gas wells, earthquakes, mines, and quarries—all supporting resource exploration, environmental protection, and engineering studies.</p>
                    <br/>
                    <a href="https://kgs.uky.edu/kygeode/" class="inter-button">Explore Data</a>
                </div>
                <img src="/assets/index/kgs-coreviewing.webp" alt="KGS Core Viewing">
            </div>
        </section>

        <!-- News Section -->
        <section class="section-news">
            <div class="section-container">
                <h2 class="inter-h2">KGS News and Announcements</h2>
                <div class="news-tile-container">
                    {articles.length > 0 ? (
                        <NewsGrid articles={articles} layout="grid" />
                    ) : (
                        <!-- Fallback news tiles if no articles are available -->
                    )}
                </div>

                <!-- Add "View All News" button if using NewsGrid -->
                {articles.length > 0 && (
                    <div class="news-view-all-container">
                        <a href="/news/" class="news-view-all-button inter-button">View All News</a>
                    </div>
                )}
            </div>
        </section>
    </main>

    <!-- Use your Astro Footer component -->
    <Footer />
   <script>
    document.addEventListener('DOMContentLoaded', () => {
        const video = document.getElementById('hero-video');
        const controlBtn = document.getElementById('video-control-btn');
        
        if (!video || !controlBtn) {
            console.warn('Video or control button not found');
            return;
        }
        
        // Toggle video playback
        function toggleVideo() {
            if (video.paused) {
                video.play();
                controlBtn.classList.remove('paused');
                controlBtn.setAttribute('aria-label', 'Pause background video');
                controlBtn.setAttribute('aria-pressed', 'false');
            } else {
                video.pause();
                controlBtn.classList.add('paused');
                controlBtn.setAttribute('aria-label', 'Play background video');
                controlBtn.setAttribute('aria-pressed', 'true');
            }
        }
        
        // Click event
        controlBtn.addEventListener('click', toggleVideo);
        
        // Keyboard support (Space and Enter)
        controlBtn.addEventListener('keydown', (e) => {
            if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                toggleVideo();
            }
        });
        
        // Optional: Pause video when user navigates away from tab
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && !video.paused) {
                video.pause();
                controlBtn.classList.add('paused');
                controlBtn.setAttribute('aria-label', 'Play background video');
                controlBtn.setAttribute('aria-pressed', 'true');
            }
        });
        
        // Respect user's motion preferences
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
        
        if (prefersReducedMotion.matches) {
            video.pause();
            controlBtn.classList.add('paused');
            controlBtn.setAttribute('aria-label', 'Play background video');
            controlBtn.setAttribute('aria-pressed', 'true');
        }
        
        // Listen for changes in motion preference
        prefersReducedMotion.addEventListener('change', (e) => {
            if (e.matches && !video.paused) {
                video.pause();
                controlBtn.classList.add('paused');
                controlBtn.setAttribute('aria-label', 'Play background video');
                controlBtn.setAttribute('aria-pressed', 'true');
            }
        });
    });
</script>
</body>
</html>