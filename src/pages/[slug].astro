---
// Static generation approach (recommended for content pages)
export const prerender = false;
import Layout from "../layouts/BaseLayout.astro";
import directus from "../../lib/directus";
import { readItems } from "@directus/sdk";

export async function getStaticPaths() {
  try {
    const pages = await directus.request(readItems("pages", {
      filter: {
        status: { _eq: "published" } // For Staging View all status
      }
    }));
 
    return pages.map((page) => ({
      params: { slug: page.slug },
      props: { page }, // Wrap in an object
    }));
  } catch (error) {
    console.error("Error fetching pages:", error);
    return [];
  }
}

// Get the page from props
const { page } = Astro.props;

// Handle 404 if page not found
if (!page) {
  return Astro.redirect('/404');
}
---

<Layout title={page.title}>
  <main>
    <h1>{page.title}</h1>
    <div set:html={page.content} />
  </main>
</Layout>
