---
// src/pages/intern/[year].astro
export const prerender = false;
import BaseLayout from '../../layouts/BaseLayout.astro';
import InternSidebar from '../../components/intern/InternSidebar.astro';
import ApplyBox from '../../components/intern/ApplyBox.astro';
import { fetchCurrentInternDetails, fetchInternDetailsByYear } from '../../lib/api_intern';
import { ACTION_ERROR_CODES } from 'astro:actions';

// Get the year from params
const { year } = Astro.params;
const currentDetails = await fetchCurrentInternDetails();
const programYear = year ? parseInt(year) : currentDetails?.program_year;

// Fetch details for the specific year
const details = programYear ? await fetchInternDetailsByYear(programYear) : currentDetails;

if (!details) {
  return Astro.redirect('/intern');
}

const directusUrl = import.meta.env.PUBLIC_DIRECTUS_URL;

// Format dates for display
function formatDate(dateString) {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

const isCurrentYear = details.program_year === currentDetails?.program_year;

// Check if we're in the "stay tuned" period
const today = new Date();
const programEndDate = new Date(details.program_end_date);
const showStayTunedMessage = today > programEndDate;
const app_url = !!details.app_form_url;
---

<BaseLayout 
  title={`Paul Edwin Potter Internship Program: ${details.program_year} Eligibility and Application`}
  description={`Information about the ${details.program_year} Paul Edwin Potter Internship Program - application dates, eligibility requirements, and what to expect.`}
  activePage="program"
>
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- Sidebar -->
    <InternSidebar activeSection="program" />

    <!-- Main Content -->
    <div class="lg:col-span-3 max-w-4xl">
    
      <!-- Stay Tuned Message (shown after program ends) -->
      {showStayTunedMessage && (
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg p-6 mb-8">
          <div class="flex items-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" class="text-blue-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-2xl font-bold text-blue-800">Stay Tuned for {details.program_year + 1}!</h3>
          </div>
          
          <p class="text-lg text-gray-700 mb-4">
            The {details.program_year} Paul Edwin Potter Internship Program has concluded. We're currently planning our 
            {details.program_year + 1} program and will post application details and project information soon.
          </p>
          
          <div class="bg-white rounded-lg p-4 border border-blue-200">
            <h4 class="font-semibold text-blue-800 mb-2">Typical Timeline</h4>
            <p class="text-sm text-gray-600">
              Based on previous years, applications typically open in late winter/early spring with the program 
              running during summer months. Check back in late {details.program_year} for specific dates.
            </p>
          </div>
        </div>
      )}
      
      <!-- Page Title -->
      <h1 class="text-3xl font-bold text-blue-900 mb-2">
        {details.program_year} Program
      </h1>
      
      <h2 class="text-xl text-gray-600 mb-8">
        {formatDate(details.program_start_date)} - {formatDate(details.program_end_date)}
      </h2>

      <!-- Overview Section -->
      <div class="grid md:grid-cols-2 gap-8 mb-8">
        <div>
          <p class="text-gray-700 mb-6">
           The Paul Edwin Potter Internship Program is designed to provide academic and professional development by <a href="/intern/why/">equipping interns with the knowledge and resources</a> required to excel in geoscience-related research.
          </p>
          
           <h3 class="text-xl font-bold text-blue-800 mb-6">Eligible Applicants</h3>

            <div class="flex items-start">
              <i class="fas fa-user-graduate text-blue-500 mt-1 mr-3 flex-shrink-0" style="font-size: 1.5rem;"></i>
              <div>
                <p class="font-semibold text-gray-900 mb-1">Education</p>
                <p class="text-gray-700">
                  Incoming and current undergraduate and master's level students enrolled at a higher education institution.
                </p>
              </div>
            </div>
            
            <div class="flex items-start mt-5">
              <i class="fas fa-globe-americas text-blue-500 mt-1 mr-3 flex-shrink-0" style="font-size: 1.5rem;"></i>
              <div>
                <p class="font-semibold text-gray-900 mb-1">Field of Study</p>
                <p class="text-gray-700">
                  Students interested in geoscience and related fields such as environmental science, physics, engineering, 
                  public health, or geography.
                </p>
              </div>
            </div>
        </div>
        
        <!-- Project Image -->
        {details.project_image && (
          <div class="text-center" style="align-self: center;">
            <figure>
              <img 
                src={`${directusUrl}assets/${details.project_image}?width=800&quality=90`}
                alt={details.project_image_caption || `${details.program_year} internship project`}
                class="w-full h-auto rounded-lg shadow-lg"
              />
              {details.project_image_caption && (
                <figcaption class="text-sm text-gray-600 mt-2">
                  {details.project_image_caption}
                </figcaption>
              )}
            </figure>
          </div>
        )}
      </div>

      <!-- ========================================
           ELIGIBILITY AND APPLICATION SECTION
           ======================================== -->
      
      <div class="mb-12">
        <!-- Application Information (if current year AND not past program end) -->
        {isCurrentYear && !showStayTunedMessage && (
          <div class="bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 rounded-lg p-6 mb-6">
           
            <div>
              <div id="application-dates" class="mb-6">
                <h4 class="font-semibold text-gray-800 mb-4 text-lg">
                  <i class="fas fa-calendar-alt text-gray-600 mt-2 mr-2"></i>
                  {details.program_year} Program Key Dates:
                </h4>
                
                <!-- Mobile: Simple List (hidden on md and up) -->
                <ul class="space-y-2 text-md text-gray-700 md:hidden">
                  <li class="py-1">
                    <b>Application Period:</b> {formatDate(details.application_start_date)} - {formatDate(details.application_end_date)}
                  </li>
                  <li class="py-1">
                    <b>Offer Letters:</b> {details.offer_letter_date}
                  </li>
                  <li class="py-1">
                    <b>Program Duration:</b> {formatDate(details.program_start_date)} - {formatDate(details.program_end_date)}
                  </li>
                </ul>

                <!-- Desktop: Timeline (hidden on mobile, shown on md and up) -->
                <div class="hidden md:block relative pt-8 pb-4 px-4">
                  <!-- Timeline Line -->
                  <div class="absolute left-4 right-4" style="top: 9rem;">
                    <div class="h-4 bg-gradient-to-r from-blue-400 via-green-400 to-purple-500 rounded-full shadow-md"></div>
                  </div>
                  
                  <!-- Timeline Markers -->
                  <div class="relative grid grid-cols-5 gap-2">
                    <!-- Application Start -->
                    <div class="flex flex-col items-center">
                      <div class="w-5 h-5 bg-blue-500 rounded-full border-4 border-white shadow-lg mb-3 relative z-10"></div>
                      <div class="text-center">
                        <div class="text-sm font-semibold text-blue-800 mb-1">Application Opens</div>
                        <div class="text-sm text-gray-900">{new Date(details.application_start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                      </div>
                    </div>
                    
                    <!-- Application End -->
                    <div class="flex flex-col items-center">
                      <div class="w-5 h-5 bg-blue-600 rounded-full border-4 border-white shadow-lg mb-3 relative z-10"></div>
                      <div class="text-center">
                        <div class="text-sm font-semibold text-blue-800 mb-1">Application Deadline</div>
                        <div class="text-sm text-gray-900">{new Date(details.application_end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                      </div>
                    </div>
                    
                    <!-- Offer Letters -->
                    <div class="flex flex-col items-center" style="margin-left: -60%;">
                      <div class="w-5 h-5 bg-green-500 rounded-full border-4 border-white shadow-lg mb-3 relative z-10"></div>
                      <div class="text-center">
                        <div class="text-sm font-semibold text-green-800 mb-1">Offer Letters</div>
                        <div class="text-sm text-gray-900">{details.offer_letter_date}</div>
                      </div>
                    </div>
                    
                    <!-- Program Start -->
                    <div class="flex flex-col items-center">
                      <div class="w-5 h-5 bg-purple-500 rounded-full border-4 border-white shadow-lg mb-3 relative z-10"></div>
                      <div class="text-center">
                        <div class="text-sm font-semibold text-purple-800 mb-1">Program Start</div>
                        <div class="text-sm text-gray-900">{new Date(details.program_start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                      </div>
                    </div>
                    
                    <!-- Program End -->
                    <div class="flex flex-col items-center">
                      <div class="w-5 h-5 bg-purple-700 rounded-full border-4 border-white shadow-lg mb-3 relative z-10"></div>
                      <div class="text-center">
                        <div class="text-sm font-semibold text-purple-800 mb-1">Program End</div>
                        <div class="text-sm text-gray-900">{new Date(details.program_end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Month Labels Below Timeline -->
                  <div class="grid grid-cols-8 mt-14 text-sm text-gray-900 font-medium px-4">
                    <span>Dec</span>
                    <span>Jan</span>
                    <span>Feb</span>
                    <span>Mar</span>
                    <span>Apr</span>
                    <span>May</span>
                    <span>Jun</span>
                    <span>Jul</span>
                  </div>
                </div>
              </div>
              
             </div>
          </div>
        )}

     <!-- Apply -->
      <ApplyBox programYear={details.program_year} appFormUrl={details.app_form_url} />

      <!-- ========================================
       WHAT TO EXPECT SECTION
       ======================================== -->
      
      <div class="mb-12 mt-8" id="what-to-expect">
        <h2 class="font-bold text-blue-900 mb-6 border-b-2 border-blue-200 pb-2">
          What to Expect
        </h2>

        <!-- Project Description from Directus -->
        {details.project_description && (
          <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h3 class="text-xl font-bold text-blue-800 mb-6">{details.program_year} Experience</h3>
            <div 
              class="prose max-w-none text-gray-700"
              set:html={details.project_description}
            />
            <div>
                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                  <i class="fas fa-sun-alt text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                  How is this different from a summer job?
                </h4>
                <p class="text-gray-700 ml-7">
                  Most summer jobs won't let you design your experience. This is an all-encompassing research and professional 
                  development experience. We will assign you a project topic, and you'll work with mentors to develop a research 
                  question and work plan for the summer, making tweaks along the way. Outside of your research tasks, we also 
                  provide public speaking training, mock interviews, and several field trips and seminars with UK faculty and staff.
                </p>
            </div>
            <div class="mt-6">
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-users-cog text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Will I work independently?
              </h4>
              <p class="text-gray-700 ml-7">
                Yes and no. We design the program to closely mimic a real-world research team, so each intern will be given 
                their own project, but these will often overlap with other projects, and all interns will collaborate to learn 
                techniques and complete field work.
              </p>
            </div>
            {details.faq_skills && (
              <div class="mt-6">
                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                  <i class="fas fa-tools text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                  What skills will I learn?
                </h4>
                <div 
                  style="padding-left:1px"
                  class="prose text-gray-700 ml-7"
                  set:html={details.faq_skills}
                />
              </div>
            )}
        </div>
      )}

        <!-- Intern Showcase -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 rounded-lg p-8 mb-8" id="showcase">
          <h3 class="text-xl font-bold text-purple-800 mb-4">Intern Showcase</h3>
          <p class="text-gray-700 mb-4">
            At the end of the internship, interns will present their work in a combined 
            <a href="https://uknow.uky.edu/research/showcase-highlight-kgs-potter-internship-program" target="_blank">lightning talk and poster session</a>. 
              Short lightning talks provide interns the opportunity to concisely convey research products related to current and emerging KGS work. 
              The poster session allows networking with future colleagues and requires the ability to communicate complex scientific concepts in a 
              visually appealing and compelling way.
          </p>
          
          <div class="text-center">
            <a 
              href="/intern/projects" 
              class="inline-flex items-center px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition"
            >
              View Past Projects
              <i class="fas fa-arrow-right ml-3"></i>
            </a>
          </div>
        </div>

        <!-- FAQ Section -->
        <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-lg p-8" id="faq">
          <h3 class="text-xl font-bold text-green-800 mb-6">Frequently Asked Questions</h3>
          
          <div class="space-y-6">
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-dollar-sign text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Is this a paid experience?
              </h4>
              <p class="text-gray-700 ml-7">
                Yes! This is a paid internship. Interns will be paid <b>{details.pay_rate}</b> as participants in the program.
              </p>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-earth-americas text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Do I have to be a student at the University of Kentucky to apply?
              </h4>
              <p class="text-gray-700 ml-7">
                No. Any interested incoming or enrolled undergraduate or master's level student at a higher education institution may apply.
              </p>
            </div>

            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-gem text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Do I need to be a Geoscience major?
              </h4>
              <p class="text-gray-700 ml-7">
                No, we welcome students with a wide range of related educational backgrounds. Our project topics vary from year to year and require skill sets from Environmental Sciences, Physics, Engineering, Public Health, Geography, Statistics, Communications, etc.
              </p>
            </div>


            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-file-alt text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Do you have any tips about formatting our resume or cover letter?
              </h4>
              <p class="text-gray-700 ml-7">
                    
                We would like you to submit a one- or two-page resume and a one- or two-page letter of interest/cover letter. 
                We will use this information to get to know you and match you to a potential position. 
                Specific instructions are provided on the application form. 
                Don't stress too much about being the best or perfect. 
                We will have training exercises later in the program to help hone these skills.
                <br><br>
                If you would like your resume and cover letter reviewed before submission please submit a finalized draft version as a 
                Word document to <a href="mailto:kgspotterinternship@uky.edu">kgspotterinternship@uky.edu</a> 
                by {formatDate(details.application_review_end)}. Please include in your email, your name, and specific questions or 
                concerns you would like addressed.
              </p>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-home text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Is housing provided?
              </h4>
              <p class="text-gray-700 ml-7">
                Interns are responsible for paying for their local housing, transportation, parking, and food. 
                The University of Kentucky provides the following campus options:
                <ul class="list-disc list-inside mt-2" style="margin-left:20px">
                  <li>
                    <a href="https://wildcatliving.uky.edu/overnight-accommodations-campus" target="_blank" class="text-blue-600 underline">
                      Housing
                    </a> - Offers summer housing for students in a dormitory setting.
                  </li>
                  <li>
                    <a href="https://www.uky.edu/transportation/" target="_blank" class="text-blue-600 underline">
                      Transportation
                    </a> - Provides information on public transit at the University of Kentucky.
                  </li>
                  <li>
                    <a href="https://www.uky.edu/transportation/park/employee-permits" target="_blank" class="text-blue-600 underline">
                      Parking
                    </a> - Details on parking permits at the University of Kentucky.
                  </li>
                  <li>
                    <a href="https://uky.campusdish.com/" target="_blank" class="text-blue-600 underline">
                      Dining
                    </a> - Information on dining options at the University of Kentucky.
                  </li>
                </ul>
            </div>

            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-clock text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                What is the time commitment?
              </h4>
              <p class="text-gray-700 ml-7">
                The {details.program_year} internship will run from <b>{formatDate(details.program_start_date)}</b> to <b>{formatDate(details.program_end_date)}</b>. 
                We expect interns to work 40 hours a week for the entire 10-week period and attend program seminars and field experiences.
              </p>
            </div>
          </div>
        </div>
      </div>


      <!-- Bottom images -->
      {details.bottom_image_1 && (
        <div id="bottom-images" class="mb-12 mt-4 flex justify-center">
          <div class="w-3/4 max-w-4xl flex flex-col items-center text-left">
            <figure class="w-full">
              <img 
                src={`${directusUrl}assets/${details.bottom_image_1}?width=800&quality=90`}
                alt={details.bottom_image_1_caption || details.bottom_image_caption || `${details.program_year-1} internship project`}
                class="w-full h-auto rounded-lg shadow-lg mx-auto"
              />

              {details.bottom_image_2 && (
                <img 
                  src={`${directusUrl}assets/${details.bottom_image_2}?width=800&quality=90`}
                  alt={details.bottom_image_2_caption || details.bottom_image_caption || `${details.program_year-1} internship project`}
                  class="w-full h-auto rounded-lg shadow-lg mt-6 mx-auto"
                />
              )}

              {details.bottom_images_caption && (
                <figcaption class="text-md text-gray-600 mt-2">
                  {details.bottom_images_caption}
                </figcaption>
              )}
            </figure>
          </div>
        </div>
      )}


     <!-- Apply -->
    <ApplyBox programYear={details.program_year} appFormUrl={details.app_form_url} />

    </div>
  </div>
</BaseLayout>