---
// src/pages/intern/[year].astro
export const prerender = false;
import BaseLayout from '../../layouts/BaseLayout.astro';
import InternSidebar from '../../components/InternSidebar.astro';
import { fetchCurrentInternDetails, fetchInternDetailsByYear } from '../../lib/api_intern';

// Get the year from params
const { year } = Astro.params;
const currentDetails = await fetchCurrentInternDetails();
const programYear = year ? parseInt(year) : currentDetails?.program_year;

// Fetch details for the specific year
const details = programYear ? await fetchInternDetailsByYear(programYear) : currentDetails;

if (!details) {
  return Astro.redirect('/intern');
}

const directusUrl = import.meta.env.PUBLIC_DIRECTUS_URL;

// Format dates for display
function formatDate(dateString) {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

const isCurrentYear = details.program_year === currentDetails?.program_year;
---

<BaseLayout 
  title={`${details.program_year} Internship Program`}
  description={`Information about the ${details.program_year} Paul Edwin Potter Internship Program - application dates, project details, and requirements.`}
  activePage="intern"
>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- Sidebar -->
    <InternSidebar activeSection="program" />

    <!-- Main Content -->
    <div class="lg:col-span-3 max-w-4xl">
    <h1 class="text-3xl font-bold text-blue-900 mb-2">
      The Paul Edwin Potter Internship - {details.program_year} Program
    </h1>
    
    <h2 class="text-xl text-gray-600 mb-8">
      {formatDate(details.program_start_date)} - {formatDate(details.program_end_date)}
    </h2>

    <!-- Program Description -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h3 class="text-2xl font-bold text-blue-800 mb-6">Program Overview</h3>
      
      <p class="text-lg mb-6">
        Our program is designed to provide academic and professional development by equipping interns with the knowledge and resources required to 
        excel in geoscience-related research. In addition to participating in projects led by KGS researchers, interns will be required to attend a weekly 
        program of seminars and field experiences.
      </p>
      
      <div class="grid md:grid-cols-2 gap-8 mb-8">
        <div>
          <h4 class="text-lg font-semibold text-blue-700 mb-4">These activities cover topics including:</h4>
          <ul class="space-y-2 text-gray-700">
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Data and physical sample management
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Respectful and safe fieldwork
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Responsible conduct of research
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Abstract writing and publication preparation
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Resume writing and mock interviews
            </li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold text-blue-700 mb-4">Additional opportunities:</h4>
          <ul class="space-y-2 text-gray-700">
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Networking and mentorship programs
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Academic and career development resources
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Social and interpersonal career coaching
            </li>
            <li class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Research presentations and field experiences
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Project Image if available -->
      {details.project_image && (
        <div class="text-center mb-6">
          <figure>
            <img 
              src={`${directusUrl}assets/${details.project_image}?width=800&quality=90`}
              alt={details.project_image_caption || "Project image"}
              class="w-full max-w-2xl h-auto rounded-lg shadow-md mx-auto"
            />
            {details.project_image_caption && (
              <figcaption class="text-sm text-gray-600 mt-2 italic">
                {details.project_image_caption}
              </figcaption>
            )}
          </figure>
        </div>
      )}
    </div>

    <!-- Application Information (if current year) -->
    {isCurrentYear && (
      <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-8 mb-8">
        <div class="flex items-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" class="text-green-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
          </svg>
          <h3 class="text-2xl font-bold text-green-800">Apply Now for {details.program_year}</h3>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-800 mb-3">Important Dates:</h4>
            <ul class="space-y-2 text-sm">
              <li><strong>Application Period:</strong> {formatDate(details.application_start_date)} - {formatDate(details.application_end_date)}</li>
              <li><strong>Application Review:</strong> {formatDate(details.application_review_start)} - {formatDate(details.application_review_end)}</li>
              <li><strong>Round One Interviews:</strong> {details.round_one_interview_date}</li>
              <li><strong>Round Two Interviews:</strong> {details.round_two_interview_date}</li>
              <li><strong>Offer Letters:</strong> {details.offer_letter_date}</li>
            </ul>
          </div>
          
          <div class="flex flex-col justify-center">
            {details.app_form_url ? (
              <a 
                href={details.app_form_url}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center justify-center px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition mb-3"
              >
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
                Apply Online
              </a>
            ) : (
              <div class="text-center py-3 px-6 bg-gray-100 text-gray-600 rounded-lg">
                Application information coming soon
              </div>
            )}
            <p class="text-xs text-gray-600 text-center">
              Questions? Email <a href="mailto:kgspotterinternship@uky.edu" class="text-blue-600 hover:underline">kgspotterinternship@uky.edu</a>
            </p>
          </div>
        </div>
      </div>
    )}

    <!-- Eligibility Requirements -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h3 class="text-2xl font-bold text-blue-800 mb-6">Eligible Applicants</h3>
      
      <div class="space-y-4">
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.5rem; height: 1.5rem;" class="text-blue-500 mt-1 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          <p>
            <strong>Education:</strong> Undergraduate and master's level students enrolled at a higher education institution in Kentucky or surrounding area. 
            This includes but is not limited to the University of Cincinnati, Marshall University, Hanover College, etc.
          </p>
        </div>
        
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.5rem; height: 1.5rem;" class="text-blue-500 mt-1 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          <p>
            <strong>Field of Study:</strong> Students interested in geoscience and related fields such as environmental science, physics, engineering, 
            public health, or geography.
          </p>
        </div>
        
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.5rem; height: 1.5rem;" class="text-blue-500 mt-1 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p>
            <strong>Time Commitment:</strong> Able to commit 40 hours per week for ten weeks and attend program seminars and field experiences.
          </p>
        </div>
      </div>
    </div>

    <!-- Project Details -->
    {details.project_description && (
      <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
        <h3 class="text-2xl font-bold text-blue-800 mb-6">{details.program_year} Projects</h3>
        <div 
          class="prose max-w-none"
          set:html={details.project_description}
        />
      </div>
    )}

    <!-- Showcase Section -->
    <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-8">
      <h3 class="text-2xl font-bold text-purple-800 mb-4">KGS Paul Edwin Potter Internship Showcase</h3>
      <p class="text-gray-700 mb-4">
        At the end of the internship, interns will present their work in a poster session. The goal of this showcase is to ensure interns have the 
        opportunity to develop research products related to current and emerging KGS work. The poster session gives interns an opportunity to network with 
        future colleagues, sharpen their presentation skills, and learn to convey complex scientific concepts in a visually appealing and compelling way.
      </p>
      
      <div class="text-center">
        <a 
          href="/intern/projects" 
          class="inline-flex items-center px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition"
        >
          View Past Project Showcases
          <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.25rem; height: 1.25rem;" class="ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
    </div>
  </div>
</BaseLayout>