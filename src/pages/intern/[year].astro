---
// src/pages/intern/[year].astro
export const prerender = false;
import BaseLayout from '../../layouts/BaseLayout.astro';
import InternSidebar from '../../components/intern/InternSidebar.astro';
import ApplyBox from '../../components/intern/ApplyBox.astro';
import { fetchCurrentInternDetails, fetchInternDetailsByYear } from '../../lib/api_intern';

// Get the year from params
const { year } = Astro.params;
const currentDetails = await fetchCurrentInternDetails();
const programYear = year ? parseInt(year) : currentDetails?.program_year;

// Fetch details for the specific year
const details = programYear ? await fetchInternDetailsByYear(programYear) : currentDetails;

if (!details) {
  return Astro.redirect('/intern');
}

const directusUrl = import.meta.env.PUBLIC_DIRECTUS_URL;

// Format dates for display
function formatDate(dateString) {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

const isCurrentYear = details.program_year === currentDetails?.program_year;

// Check if we're in the "stay tuned" period
const today = new Date();
const programEndDate = new Date(details.program_end_date);
const showStayTunedMessage = isCurrentYear && today > programEndDate;
const app_url = !!details.app_form_url;
---

<BaseLayout 
  title={`${details.program_year} Internship Program - Eligibility and Application`}
  description={`Information about the ${details.program_year} Paul Edwin Potter Internship Program - application dates, eligibility requirements, and what to expect.`}
  activePage="program"
>
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- Sidebar -->
    <InternSidebar activeSection="program" />

    <!-- Main Content -->
    <div class="lg:col-span-3 max-w-4xl">
    
      <!-- Stay Tuned Message (shown after program ends) -->
      {showStayTunedMessage && (
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg p-6 mb-8">
          <div class="flex items-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" class="text-blue-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-2xl font-bold text-blue-800">Stay Tuned for {details.program_year + 1}!</h3>
          </div>
          
          <p class="text-lg text-gray-700 mb-4">
            The {details.program_year} Paul Edwin Potter Internship Program has concluded. We're currently planning our 
            {details.program_year + 1} program and will post application details and project information soon.
          </p>
          
          <div class="bg-white rounded-lg p-4 border border-blue-200">
            <h4 class="font-semibold text-blue-800 mb-2">Typical Timeline</h4>
            <p class="text-sm text-gray-600">
              Based on previous years, applications typically open in late winter/early spring with the program 
              running during summer months. Check back in late {details.program_year} for specific dates.
            </p>
          </div>
        </div>
      )}
      
      <!-- Page Title -->
      <h1 class="text-3xl font-bold text-blue-900 mb-2">
        {details.program_year} Program
      </h1>
      
      <h2 class="text-xl text-gray-600 mb-8">
        {formatDate(details.program_start_date)} - {formatDate(details.program_end_date)}
      </h2>

      <!-- Overview Section -->
      <div class="grid md:grid-cols-2 gap-8 mb-8">
        <div>
          <p class="text-gray-700 mb-6">
            The program seeks to cultivate the expertise of any early career scientists with an interest in earth sciences, which is why we have progressively expanded our geographic eligibility year after year. Since its inception in 2022, the KGS Potter internship program has connected students from several universities across geoscience and related disciplines, and we are always eager to grow that list!
          </p>
          
           <h3 class="text-xl font-bold text-blue-800 mb-6">Eligible Applicants</h3>

            <div class="flex items-start">
              <i class="fas fa-user-graduate text-blue-500 mt-1 mr-3 flex-shrink-0" style="font-size: 1.5rem;"></i>
              <div>
                <p class="font-semibold text-gray-900 mb-1">Education</p>
                <p class="text-gray-700">
                  Incoming and current undergraduate and master's level students enrolled at a higher education institution.
                </p>
              </div>
            </div>
            
            <div class="flex items-start mt-5">
              <i class="fas fa-globe-americas text-blue-500 mt-1 mr-3 flex-shrink-0" style="font-size: 1.5rem;"></i>
              <div>
                <p class="font-semibold text-gray-900 mb-1">Field of Study</p>
                <p class="text-gray-700">
                  Students interested in geoscience and related fields such as environmental science, physics, engineering, 
                  public health, or geography.
                </p>
              </div>
            </div>
        </div>
        
        <!-- Project Image -->
        {details.project_image && (
          <div class="text-center" style="align-self: center;">
            <figure>
              <img 
                src={`${directusUrl}assets/${details.project_image}?width=800&quality=90`}
                alt={details.project_image_caption || `${details.program_year} internship project`}
                class="w-full h-auto rounded-lg shadow-lg"
              />
              {details.project_image_caption && (
                <figcaption class="text-sm text-gray-600 mt-2">
                  {details.project_image_caption}
                </figcaption>
              )}
            </figure>
          </div>
        )}
      </div>

      <!-- ========================================
           ELIGIBILITY AND APPLICATION SECTION
           ======================================== -->
      
      <div class="mb-12">
        <!-- Application Information (if current year AND not past program end) -->
        {isCurrentYear && !showStayTunedMessage && (
          <div class="bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 rounded-lg p-6 mb-6">
           
            <div>
              <div id="application-dates" class="mb-6">
                <h4 class="font-semibold text-gray-800 mb-3 text-lg">
                  <i class="fas fa-calendar-alt text-gray-600 mt-2 mr-2"></i>
                  {details.program_year} Program Key Dates:</h4>
                <ul class="space-y-2 text-lg text-gray-700">
                  <li class="py-1">
                    <b>Application Period:</b> {formatDate(details.application_start_date)} - {formatDate(details.application_end_date)}
                  </li>
                  <li class="py-1">
                    <b>Application Review:</b> {formatDate(details.application_review_start)} - {formatDate(details.application_review_end)}
                  </li>
                  <li class="py-1">
                    <b>Round One Interviews:</b> {details.round_one_interview_date}
                  </li>
                  <li class="py-1">
                    <b>Round Two Interviews:</b> {details.round_two_interview_date}
                  </li>
                  <li class="py-1">
                    <b>Offer Letters:</b> {details.offer_letter_date}
                  </li>
                  <li class="py-1">
                    <b>Program Duration:</b> {formatDate(details.program_start_date)} - {formatDate(details.program_end_date)}
                  </li>
                </ul>
              </div>
              
             </div>
          </div>
        )}

     <!-- Apply -->
      <ApplyBox programYear={details.program_year} appFormUrl={details.app_form_url} />

      <!-- ========================================
       WHAT TO EXPECT SECTION
       ======================================== -->
      
      <div class="mb-12 mt-8" id="what-to-expect">
        <h2 class="font-bold text-blue-900 mb-6 border-b-2 border-blue-200 pb-2">
          What to Expect
        </h2>

        <!-- Project Description from Directus -->
        {details.project_description && (
          <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h3 class="text-xl font-bold text-blue-800 mb-6">{details.program_year} Experience</h3>
            <div 
              class="prose max-w-none text-gray-700"
              set:html={details.project_description}
            />
          </div>
        )}

        <!-- Intern Showcase -->
        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 rounded-lg p-8 mb-8" id="showcase">
          <h3 class="text-xl font-bold text-purple-800 mb-4">Intern Showcase</h3>
          <p class="text-gray-700 mb-4">
            At the end of the internship, interns will present their work in a combined 
            <a href="https://uknow.uky.edu/research/showcase-highlight-kgs-potter-internship-program" target="_blank">lightning talk and poster session</a>. 
              Short lightning talks provide interns the opportunity to concisely convey research products related to current and emerging KGS work. 
              The poster session allows networking with future colleagues and requires the ability to communicate complex scientific concepts in a 
              visually appealing and compelling way.
          </p>
          
          <div class="text-center">
            <a 
              href="/intern/projects" 
              class="inline-flex items-center px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition"
            >
              View Past Projects
              <i class="fas fa-arrow-right ml-3"></i>
            </a>
          </div>
        </div>

        <!-- What to Expect FAQ -->
        <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-lg p-8">
          <h3 class="text-xl font-bold text-green-800 mb-6">Frequently Asked Questions</h3>
          
          <div class="space-y-6">
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-briefcase text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                What will I be working on?
              </h4>
              <div 
                class="prose max-w-none text-gray-700"
                set:html={details.faq_working_on}
              />
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-tools text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                What skills will I learn?
              </h4> 
              <p>It depends on your project! However, most of our interns will work in standard GIS software packages and learn the basics of planning field work and note taking. Past that, some of our projects have allowed interns to build skills in:</p>
                <table class="w-full table-auto border border-gray-200 rounded-lg overflow-hidden text-sm">
                <thead class="bg-gray-50">
                  <tr>
                  <th class="text-left px-4 py-3 border-b border-gray-200">Software/Analytical</th>
                  <th class="text-left px-4 py-3 border-b border-gray-200">Field</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 bg-white">
                  <tr>
                  <td class="px-4 py-2">ArcGIS Pro</td>
                  <td class="px-4 py-2">Dye tracing</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">RStudio</td>
                  <td class="px-4 py-2">Electrical resistivity tomography</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">QGIS</td>
                  <td class="px-4 py-2">Water and soil sampling</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">Soil geochemistry</td>
                  <td class="px-4 py-2">Drone lidar acquisition</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">TUFLOW</td>
                  <td class="px-4 py-2">Soil infiltration testing</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">Lidar processing and interpretation</td>
                  <td class="px-4 py-2">Field notes and measurements</td>
                  </tr>
                  <tr>
                  <td class="px-4 py-2">Standard lab safety</td>
                  <td class="px-4 py-2">Radon testing</td>
                  </tr>
                </tbody>
                </table>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-dollar-sign text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Is this a paid experience?
              </h4>
              <p class="text-gray-700 ml-7">
                Yes! This is a paid internship. Interns will be paid {details.pay_rate} as participants in the program.
              </p>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-sun-alt text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                How is this different from a summer job?
              </h4>
              <p class="text-gray-700 ml-7">
                Most summer jobs won't let you design your experience. This is an all-encompassing research and professional 
                development experience. We will assign you a project topic, and you'll work with mentors to develop a research 
                question and work plan for the summer, making tweaks along the way. Outside of your research tasks, we also 
                provide public speaking training, mock interviews, and several field trips and seminars with UK faculty and staff.
              </p>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-users-cog text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                Will I work independently?
              </h4>
              <p class="text-gray-700 ml-7">
                Yes and no. We design the program to closely mimic a real-world research team, so each intern will be given 
                their own project, but these will often overlap with other projects, and all interns will collaborate to learn 
                techniques and complete field work.
              </p>
            </div>
            
            <div>
              <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-clock text-green-600 mr-2" style="font-size: 1.25rem;"></i>
                What is the time commitment?
              </h4>
              <p class="text-gray-700 ml-7">
                The {details.program_year} internship will run from {formatDate(details.program_start_date)} to {formatDate(details.program_end_date)}. 
                We expect interns to work 40 hours a week for the entire 10-week period and attend program seminars and field experiences.
              </p>
            </div>
          </div>
        </div>
      </div>


      <!-- Bottom images -->
      {details.bottom_image_1 && (
        <div id="bottom-images" class="mb-12 mt-4 flex justify-center">
          <div class="w-3/4 max-w-4xl flex flex-col items-center text-left">
            <figure class="w-full">
              <img 
                src={`${directusUrl}assets/${details.bottom_image_1}?width=800&quality=90`}
                alt={details.bottom_image_1_caption || details.bottom_image_caption || `${details.program_year-1} internship project`}
                class="w-full h-auto rounded-lg shadow-lg mx-auto"
              />

              {details.bottom_image_2 && (
                <img 
                  src={`${directusUrl}assets/${details.bottom_image_2}?width=800&quality=90`}
                  alt={details.bottom_image_2_caption || details.bottom_image_caption || `${details.program_year-1} internship project`}
                  class="w-full h-auto rounded-lg shadow-lg mt-6 mx-auto"
                />
              )}

              {details.bottom_images_caption && (
                <figcaption class="text-md text-gray-600 mt-2">
                  {details.bottom_images_caption}
                </figcaption>
              )}
            </figure>
          </div>
        </div>
      )}


     <!-- Apply -->
    <ApplyBox programYear={details.program_year} appFormUrl={details.app_form_url} />

    </div>
  </div>
</BaseLayout>