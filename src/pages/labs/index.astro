---
// src/pages/labs/index.astro
export const prerender = false; // Enable SSR for this page

import { fetchAllLabs } from '../../lib/api_labs';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Fetch all published labs
const labs = await fetchAllLabs();

// Define props with defaults specific to news pages
const { 
  title = "Research Laboratories | Kentucky Geological Survey",
  description = 'Explore the specialized research labs at Kentucky Geological Survey.',
  showBreadcrumb = true,
} = Astro.props;
---
  <BaseLayout 
    title={title}
    description={description}
    activePage="labs"
    showBreadcrumb={showBreadcrumb}
  >
  
  <!-- Pass head content if needed -->
  <Fragment slot="head">
    <slot name="head-meta" />
  </Fragment>

  <div class="container mx-auto px-4 py-1">
    <div class="mb-8">
      <h1>Research Labs</h1>
      <p class="text-gray-600 mt-2">{description}</p>
    </div>
    
    {labs.length === 0 ? (
      <div class="text-center py-16 bg-white rounded-lg shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No laboratories found</h3>
        <p class="mt-1 text-sm text-gray-500">Please check back later for updates.</p>
      </div>
    ) : (
      <div class="grid md:grid-cols-2 lg:grid-cols-2 gap-6">
        {labs.map(lab => (
          <a href={`/labs/${lab.slug}`} class="block">
            <div 
              class="bg-white rounded-lg shadow-md overflow-hidden transition-all hover:-translate-y-1 hover:shadow-lg"
              style={lab.primary_color ? `--lab-accent: ${lab.primary_color}` : ''}
            >
              <div 
                class="h-2 w-full" 
                style={lab.primary_color ? `background-color: ${lab.primary_color}` : 'background-color: #0033A0'}
              ></div>
              
              <div class="p-6">
                <div class="flex items-center mb-4">
                  {lab.logo ? (
                    <div class="mr-6 w-24 h-20 flex-shrink-0 flex items-center justify-center">
                      <img 
                        src={`${import.meta.env.PUBLIC_DIRECTUS_URL}assets/${lab.logo}?width=400&quality=100`}
                        alt={`${lab.name} logo`}
                        class="max-w-full max-h-full object-contain"
                      />
                    </div>
                  ) : (
                    <div 
                      class="mr-6 w-20 h-20 flex-shrink-0 rounded-full flex items-center justify-center text-white text-xl font-bold"
                      style={lab.secondary_color ? `background-color: ${lab.secondary_color}` : 'background-color: #0033A0'}
                    >
                      {lab.short_name || lab.name.split(' ').map(word => word[0]).join('')}
                    </div>
                  )}
                  
                  <div class="flex-1 flex flex-col justify-center min-w-0">
                    <h3 
                      class="text-xl font-bold leading-tight"
                      style={lab.secondary_color ? `color: ${lab.secondary_color}` : 'color: #0033A0'}
                    >
                      {lab.name}
                    </h3>
                    {lab.short_name && (
                      <p class="text-gray-800 text-lg leading-tight mt-1">{lab.short_name}</p>
                    )}
                  </div>
                </div>
                
                {lab.short_description && (
                  <p class="text-gray-700 text-sm line-clamp-3">{lab.short_description}</p>
                )}
                
                <div class="mt-4 flex justify-end">
                  <span 
                    class="inline-flex items-center text-sm font-medium hover:underline"
                    style={lab.accent_color ? `color: ${lab.accent_color}` : 'color: #0033A0'}
                  >
                    Visit Lab
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </span>
                </div>
              </div>
            </div>
          </a>
        ))}
      </div>
    )}
  </div>
</BaseLayout>