---
// src/pages/news/index.astro
export const prerender = false; // Enable SSR for this page
import NewsLayout from '../../layouts/NewsLayout.astro';
import NewsGrid from '../../components/news/NewsGrid.astro';
import Pagination from '../../components/Pagination.astro';
import { fetchRecentNews } from '../../lib/api_news';

// Get current page from URL params
const page = parseInt(Astro.url.searchParams.get('page') || '1');
const limit = 9; // Number of news items per page

// Fetch recent news with pagination
const { articles, totalCount, totalPages } = await fetchRecentNews(limit, page);

// Meta information
const title = "News & Updates";
const description = "The latest news and announcements from the Kentucky Geological Survey.";
---

<NewsLayout>
  <!-- Head Metadata -->
  <Fragment slot="head-meta">
    <title>{title} | Kentucky Geological Survey</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
  </Fragment>
  
  <!-- Page Content -->
  <div>
    <h1 class="text-3xl font-bold text-blue-900 mb-2">News & Announcements</h1>
    <p class="text-gray-600 mb-8">Stay informed with the latest news and announcements from the Kentucky Geological Survey.</p>
    
    {articles.length > 0 ? (
      <>
        <!-- Display News Grid with Featured Layout -->
        <NewsGrid articles={articles} layout="featured" />
        
        <!-- Pagination -->
        <Pagination currentPage={page} totalPages={totalPages} baseUrl="/news" />
      </>
    ) : (
      <div class="bg-white p-8 rounded-lg shadow-md text-center">
        <svg xmlns="http://www.w3.org/2000/svg" style="width: 4rem; height: 4rem;" class="mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
        </svg>
        <h2 class="text-xl font-semibold text-gray-700 mb-2">No News Articles Yet</h2>
        <p class="text-gray-600">Check back soon for updates and announcements.</p>
      </div>
    )}
  </div>
</NewsLayout>