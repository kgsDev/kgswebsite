---
// src/components/SEOHead.astro
// A reusable component for SEO and social media meta tags

interface Props {
  title: string;
  description: string;
  image?: string;
  imageAlt?: string;
  type?: 'website' | 'article' | 'profile';
  publishedDate?: string;
  modifiedDate?: string;
  authors?: Array<{name: string, url?: string}>;
  keywords?: string[];
  canonicalUrl?: string;
}

const { 
  title, 
  description, 
  image, 
  imageAlt = "Page image", 
  type = "website",
  publishedDate,
  modifiedDate,
  authors = [],
  keywords = [],
  canonicalUrl
} = Astro.props;

// Get the base URL for absolute URLs
const siteUrl = import.meta.env.PUBLIC_SITE_URL || Astro.url.origin;
const imageUrl = image ? (image.startsWith('http') ? image : `${siteUrl}${image}`) : '';
const canonical = canonicalUrl ? (canonicalUrl.startsWith('http') ? canonicalUrl : `${siteUrl}${canonicalUrl}`) : Astro.url.href;

// Organization data for schema.org
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Kentucky Geological Survey",
  "url": siteUrl,
  "logo": `${siteUrl}/logo.png`,
  "sameAs": [
    "https://www.facebook.com/kgsnews/",
    "https://twitter.com/KGSNews",
    "https://www.linkedin.com/company/kgsnews/",
  ]
};

// Generate appropriate schema.org JSON-LD based on page type
let pageSchema;
if (type === 'article') {
  pageSchema = {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "description": description,
    "image": imageUrl || undefined,
    "datePublished": publishedDate || undefined,
    "dateModified": modifiedDate || publishedDate || undefined,
    "author": authors.length > 0 ? authors.map(author => ({
      "@type": "Person",
      "name": author.name,
      "url": author.url
    })) : undefined,
    "publisher": {
      "@type": "Organization",
      "name": "Kentucky Geological Survey",
      "logo": {
        "@type": "ImageObject",
        "url": `${siteUrl}/logo.png`
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": canonical
    }
  };
} else if (type === 'profile') {
  pageSchema = {
    "@context": "https://schema.org",
    "@type": "ProfilePage",
    "headline": title,
    "description": description,
    "mainEntity": {
      "@type": "Person",
      "name": title.split(' - ')[0] || title,
      "description": description,
      "image": imageUrl || undefined,
      "worksFor": {
        "@type": "Organization",
        "name": "Kentucky Geological Survey"
      }
    }
  };
} else {
  pageSchema = {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": title,
    "description": description,
    "url": canonical,
    "image": imageUrl || undefined
  };
}
---

<!-- SEO Meta Tags -->
<title>{title}</title>
<meta name="description" content={description} />
{keywords.length > 0 && (
  <meta name="keywords" content={keywords.join(', ')} />
)}
<link rel="canonical" href={canonical} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonical} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
{imageUrl && (
  <meta property="og:image" content={imageUrl} />
  <meta property="og:image:alt" content={imageAlt} />
)}
{publishedDate && (
  <meta property="article:published_time" content={publishedDate} />
)}
{modifiedDate && (
  <meta property="article:modified_time" content={modifiedDate} />
)}
{authors.length > 0 && authors.map(author => (
  <meta property="article:author" content={author.url || author.name} />
))}

<!-- Twitter -->
<meta name="twitter:card" content={imageUrl ? "summary_large_image" : "summary"} />
<meta name="twitter:url" content={canonical} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
{imageUrl && (
  <meta name="twitter:image" content={imageUrl} />
  <meta name="twitter:image:alt" content={imageAlt} />
)}

<!-- Schema.org JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(pageSchema)} />