---
import '../../styles/footer.css';
// Footer component with contact info and links
const currentYear = new Date().getFullYear();
---

<footer>
  <div class="footer-container">
    <div class="footer-logo">
      <img src="../../assets/index/uk-kgs-logo-white.png">
      <address class="footer-address inter-footer">
          Kentucky Geological Survey<br/>
          University of Kentucky<br/>
          504 Rose Street<br/>
          Lexington, KY 40506<br/> 
          Telephone: <a href="tel:8592575500">(859) 257-5500</a><br/>
          Email: <a href="mailto:kgsmail@uky.edu">kgsmail@uky.edu</a>
      </address>
    </div>
    <details class="source-sans-3-footer-details">
      <summary>Key Information</summary>
        <ul>
            <li><a href="/about/">About</a></li>
            <li><a href="https://www.uky.edu/KGS/geoky/">Kentucky Geology</a></li>
            <li><a href="https://kgs.uky.edu/kygeode/services/pubs/">Publications</a></li>
            <li><a href="https://kgs.uky.edu/kygeode/">Maps and Data</a></li>
            <li><a href="https://www.uky.edu/KGS/education/">Education</a></li>
            <li><a href="/about/jobs/">Job Opportunities</a></li>
        </ul>
    </details>                 
    <details class="source-sans-3-footer-details">
        <summary>Connect with KGS</summary>
        <ul>
            <li><a href="https://www.instagram.com/kygeologicalsurvey/"><img src="../../assets/index/icon-ig-svg.svg"> Follow on Instagram</a></li>
            <li><a href="https://www.facebook.com/kgsnews/"><img src="../../assets/index/icon-fb-svg.svg"> Find on Facebook</a></li>
            <li><a href="https://twitter.com/KGSNews"><img src="../../assets/index/icon-x-svg.svg"> Follow on X</a></li>
            <li><a href="https://www.linkedin.com/company/kgsnews/"><img src="../../assets/index/icon-li-svg.svg"> Follow on LinkedIn</a></li>
            <li><a href="http://www.youtube.com/user/KGSUK"><img src="../../assets/index/icon-yt-svg.svg"> Watch on YouTube</a></li>
        </ul>
    </details>
    <details class="source-sans-3-footer-details">
        <summary>Get Help</summary>
        <ul>
            <li><a href="/about/help">Help & FAQs</a></li>
            <li><a href="/about/locations">Locations & Hours</a></li>
            <li><a href="/staff/">Staff Directory</a></li>
            <li><a href="#">Sitemap</a></li>
            <li><a href="/about/ask">Request Information</a></li>
        </ul>
    </details>
</div>
<div class="footer-nav source-sans-3-footer-misc">
    <a href="https://www.uky.edu/equal-opportunity-university/">An Equal Opportunity University</a> | 
    <a href="https://www.uky.edu/privacy">Privacy</a> | 
    <a href="https://www.uky.edu/web-accessibility">Accessibility</a> | 
    <a href="https://www.uky.edu/disclosures">Disclosures</a> 
    <p>Copyright &copy; {currentYear} University of Kentucky, Kentucky Geological Survey. All rights reserved.</p>
</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function handleFooterExpansion() {
        const details = document.querySelectorAll('footer details');
        
        if (window.innerWidth >= 1100) {
            // Desktop: Open all details but keep them interactive
            details.forEach(detail => {
                detail.open = true;
                const summary = detail.querySelector('summary');
                if (summary) {
                    summary.style.pointerEvents = 'auto'; // Keep clicking enabled
                }
            });
        } else {
            // Mobile/Tablet: Close details and ensure they're interactive
            details.forEach(detail => {
                detail.open = false;
                const summary = detail.querySelector('summary');
                if (summary) {
                    summary.style.pointerEvents = 'auto';
                }
            });
        }
    }
    
    // Run on load
    handleFooterExpansion();
    
    // Run on resize
    window.addEventListener('resize', handleFooterExpansion);
});


// Unified font sizing - all titles sized based on the longest one
function unifiedRolloverSizing(maxFontSize = 2.5, minFontSize = 1.2) {
    const titles = document.querySelectorAll('.link-container .hero-link .rollover-active .inter-h3');
    
    if (titles.length === 0) return;
    
    let smallestWorkingSize = maxFontSize;
    
    // Test each title to find the constraining one
    titles.forEach(title => {
        const container = title.parentElement;
        const containerWidth = container.clientWidth - 50; // Account for padding
        
        // Temporarily set to max size to measure
        title.style.fontSize = maxFontSize + 'rem';
        
        // If it overflows, find the size that fits
        if (title.scrollWidth > containerWidth) {
            const workingSize = findOptimalSize(title, containerWidth, maxFontSize, minFontSize);
            smallestWorkingSize = Math.min(smallestWorkingSize, workingSize);
        }
    });
    
    // Apply the unified size to all titles
    titles.forEach(title => {
        title.style.fontSize = smallestWorkingSize + 'rem';
        
        // Optional: Add data attribute for debugging
        title.dataset.unifiedSize = smallestWorkingSize.toFixed(2);
    });
    
    console.log(`Rollover titles unified at ${smallestWorkingSize.toFixed(2)}rem`);
    return smallestWorkingSize;
}

// Binary search to find optimal size for a specific title
function findOptimalSize(element, containerWidth, maxSize, minSize) {
    let low = minSize;
    let high = maxSize;
    let bestSize = minSize;
    
    while (high - low > 0.05) {
        const mid = (low + high) / 2;
        element.style.fontSize = mid + 'rem';
        
        if (element.scrollWidth <= containerWidth) {
            bestSize = mid;
            low = mid;
        } else {
            high = mid;
        }
    }
    
    return bestSize;
}

// Alternative approach: Calculate based on text length ratios
function unifiedRolloverSizingByLength(maxFontSize = 2.5, minFontSize = 1.2) {
    const titles = document.querySelectorAll('.link-container .hero-link .rollover-active .inter-h3');
    
    if (titles.length === 0) return;
    
    // Find the longest title
    let longestTitle = '';
    let longestElement = null;
    
    titles.forEach(title => {
        const text = title.textContent.trim();
        if (text.length > longestTitle.length) {
            longestTitle = text;
            longestElement = title;
        }
    });
    
    // Calculate optimal size for the longest title
    const container = longestElement.parentElement;
    const containerWidth = container.clientWidth - 50;
    const optimalSize = findOptimalSize(longestElement, containerWidth, maxFontSize, minFontSize);
    
    // Apply to all titles
    titles.forEach(title => {
        title.style.fontSize = optimalSize + 'rem';
        title.dataset.unifiedSize = optimalSize.toFixed(2);
        title.dataset.basedOn = 'longest';
    });
    
    console.log(`All titles sized at ${optimalSize.toFixed(2)}rem based on: "${longestTitle}"`);
    return optimalSize;
}

// Most robust approach: Test all containers and find the most restrictive
function unifiedRolloverSizingRobust(maxFontSize = 2.5, minFontSize = 1.2) {
    const titles = document.querySelectorAll('.link-container .hero-link .rollover-active .inter-h3');
    
    if (titles.length === 0) return;
    
    let mostRestrictiveSize = maxFontSize;
    let restrictiveTitle = '';
    
    titles.forEach(title => {
        const text = title.textContent.trim();
        const container = title.parentElement;
        const containerWidth = container.clientWidth - 50; // Account for padding
        
        // Test this specific title in its specific container
        const requiredSize = calculateRequiredSize(title, containerWidth, maxFontSize, minFontSize);
        
        if (requiredSize < mostRestrictiveSize) {
            mostRestrictiveSize = requiredSize;
            restrictiveTitle = text;
        }
    });
    
    // Apply the most restrictive size to all titles
    titles.forEach(title => {
        title.style.fontSize = mostRestrictiveSize + 'rem';
        title.dataset.unifiedSize = mostRestrictiveSize.toFixed(2);
        title.dataset.restrictedBy = restrictiveTitle;
    });
    
    console.log(`All titles sized at ${mostRestrictiveSize.toFixed(2)}rem`);
    console.log(`Most restrictive title: "${restrictiveTitle}"`);
    
    return mostRestrictiveSize;
}

// Calculate what size is needed for text to fit in container
function calculateRequiredSize(element, containerWidth, maxSize, minSize) {
    // Quick estimation based on character count and container width
    const text = element.textContent.trim();
    const avgCharWidth = 0.6; // Approximate character width in rem at 1rem font size
    
    const estimatedSize = containerWidth / (text.length * avgCharWidth * 16); // Convert to rem
    const clampedSize = Math.min(Math.max(estimatedSize, minSize), maxSize);
    
    // Verify with actual measurement
    element.style.fontSize = clampedSize + 'rem';
    
    if (element.scrollWidth > containerWidth) {
        return findOptimalSize(element, containerWidth, clampedSize, minSize);
    }
    
    return clampedSize;
}

// Main setup function
function setupUnifiedRolloverSizing() {
    // Wait for fonts to load
    document.fonts.ready.then(() => {
        // Initial sizing
        unifiedRolloverSizingRobust(2.5, 1.2);
        
        // Re-size on window resize with debouncing
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                unifiedRolloverSizingRobust(2.5, 1.2);
            }, 150);
        });
    });
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', setupUnifiedRolloverSizing);

// For testing - expose functions globally
window.testRolloverSizing = {
    unified: unifiedRolloverSizing,
    byLength: unifiedRolloverSizingByLength,
    robust: unifiedRolloverSizingRobust
};
</script>

