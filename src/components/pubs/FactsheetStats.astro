---
// src/components/factsheets/FactsheetStats.astro
import type { Factsheet } from '../../lib/api_factsheets';
import { categorizeFactsheet } from '../../lib/api_factsheets';

interface Props {
  factsheets: Factsheet[];
}

const { factsheets } = Astro.props;

// Calculate statistics
const totalFactsheets = factsheets.length;

// Count by category
const categoryCount = new Map<string, number>();
factsheets.forEach(fs => {
  const category = categorizeFactsheet(fs);
  categoryCount.set(category, (categoryCount.get(category) || 0) + 1);
});

// Get years range
const years = factsheets.map(fs => fs.publication_year).filter(Boolean);
const oldestYear = years.length > 0 ? Math.min(...years) : 0;
const newestYear = years.length > 0 ? Math.max(...years) : 0;

// Count with downloads
const withDownloads = factsheets.filter(fs => fs.url_download).length;

// Count with covers
const withCovers = factsheets.filter(fs => fs.cover).length;
---

<div class="bg-gradient-to-r from-[#0033A0] to-blue-700 rounded-lg shadow-lg p-6 mb-8 text-white">
  <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
    <!-- Total Count -->
    <div class="text-center">
      <div class="text-3xl font-bold mb-1">{totalFactsheets}</div>
      <div class="text-blue-100 text-sm">Total Fact Sheets</div>
    </div>
    
    <!-- Categories -->
    <div class="text-center">
      <div class="text-3xl font-bold mb-1">{categoryCount.size}</div>
      <div class="text-blue-100 text-sm">Categories</div>
    </div>
    
    <!-- Year Range -->
    <div class="text-center">
      <div class="text-3xl font-bold mb-1">
        {oldestYear > 0 ? `${oldestYear}â€“${newestYear}` : 'N/A'}
      </div>
      <div class="text-blue-100 text-sm">Publication Years</div>
    </div>
    
    <!-- Downloads Available -->
    <div class="text-center">
      <div class="text-3xl font-bold mb-1">{withDownloads}</div>
      <div class="text-blue-100 text-sm">PDFs Available</div>
    </div>
  </div>
</div>