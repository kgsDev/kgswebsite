---
// src/components/RecentNews.astro
import { fetchRecentNews } from '../lib/api_news';
const { count = 3, showHeading = true, viewAllLink = true } = Astro.props;

// Fetch recent news articles
const { articles } = await fetchRecentNews(count, 1);
const directusUrl = import.meta.env.PUBLIC_DIRECTUS_URL;

// Format date for display
const formatDate = (dateString) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<div class="recent-news">
  {showHeading && (
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold text-blue-900">Latest News</h2>
      
      {viewAllLink && (
        <a href="/news" class="text-blue-600 hover:underline flex items-center text-sm">
          View All
          <i class="fas fa-arrow-right ml-1"></i>
        </a>
      )}
    </div>
  )}
  
  {articles.length > 0 ? (
    <div class="space-y-4">
      {articles.map(article => (
        <a href={`/news/${article.slug}`} class="block bg-white rounded-lg shadow hover:shadow-md transition p-4 flex gap-4">
          <!-- Thumbnail -->
          <div class="hidden sm:block flex-shrink-0" style="width: 100px; height: 70px;">
            {article.main_image ? (
              <img 
                src={`${directusUrl}assets/${article.main_image}?width=200&height=140&quality=80&fit=cover`} 
                alt={article.title}
                class="w-full h-full object-cover rounded"
                loading="lazy"
              />
            ) : (
              <div class="w-full h-full bg-gray-200 flex items-center justify-center rounded">
                <i class="fas fa-image text-gray-400"></i>
              </div>
            )}
          </div>
          
          <!-- Content -->
          <div class="flex-1">
            <h3 class="font-medium text-blue-800 mb-1 line-clamp-2">
              {article.title}
            </h3>
            
            <div class="text-xs text-gray-500 flex items-center mb-1">
              <i class="fas fa-regular fa-calendar mr-1"></i>
              {formatDate(article.published_date)}
            </div>
            
            {article.excerpt && (
              <p class="text-sm text-gray-600 line-clamp-2">
                {article.excerpt}
              </p>
            )}
          </div>
          
          <!-- Arrow indicator -->
          <div class="flex items-center text-blue-600">
            <i class="fas fa-chevron-right ml-1"></i>
          </div>
        </a>
      ))}
    </div>
  ) : (
    <div class="bg-white p-6 rounded-lg text-center">
      <p class="text-gray-600">No news articles available yet.</p>
    </div>
  )}
</div>

<style>
  /* Truncate text using line clamp */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>