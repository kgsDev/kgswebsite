---
// src/components/labs/ProjectCard.astro
// This component displays a project card with image, title, and short description

const { project, lab } = Astro.props;

// Truncate text to a certain length and add ellipsis if needed
const truncateText = (text, maxLength = 120) => {
  if (!text) return '';
  
  // Remove HTML tags for accurate character count
  const plainText = text.replace(/<[^>]*>/g, '');
  
  if (plainText.length <= maxLength) return plainText;
  
  // Find the last space before maxLength
  const lastSpace = plainText.substring(0, maxLength).lastIndexOf(' ');
  const truncated = plainText.substring(0, lastSpace > 30 ? lastSpace : maxLength);
  
  return truncated + '...';
};
---

<div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:-translate-y-1 hover:shadow-lg">
  <a href={`/labs/projects/${project.slug}`} class="block">
    <!-- Project Image -->
    <div class="relative aspect-video">
      {project.image ? (
        <img 
          src={`${import.meta.env.PUBLIC_DIRECTUS_URL}assets/${project.image}?width=400&height=225&fit=cover&quality=80`}
          alt={project.title}
          class="w-full h-full object-cover"
        />
      ) : (
        <div class="bg-gray-200 w-full h-full flex items-center justify-center">
          <div class="lab-accent-bg p-4 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
        </div>
      )}
      <!-- Project Status Badge -->
      <div class="absolute top-4 right-4">
        <span class={`px-3 py-1 rounded-full text-sm font-medium ${
          project.project_status === 'active' 
            ? 'bg-green-100 text-green-800' 
            : project.project_status === 'completed'
            ? 'bg-gray-100 text-gray-800'
            : 'bg-blue-100 text-blue-800'
        }`}>
          {project.project_status === 'active' ? 'Active' : 
            project.project_status === 'completed' ? 'Completed' : 
            project.project_status === 'planned' ? 'Planned' : 
            project.project_status}
        </span>
      </div>
    </div>
    
    <!-- Project Content -->
    <div class="p-4">
      <h3 class="text-lg font-bold mb-2 lab-accent-text">{project.title}</h3>
      
      <p class="text-gray-700 text-sm mb-3">
        {truncateText(project.description, 120)}
      </p>
      
      <!-- Project duration if available -->
      {(project.start_date || project.end_date) && (
        <div class="flex items-center text-xs text-gray-500 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          {project.start_date && (
            <span>
              {new Date(project.start_date).toLocaleDateString()} 
              {project.end_date && <span> - {new Date(project.end_date).toLocaleDateString()}</span>}
            </span>
          )}
          {!project.start_date && project.end_date && (
            <span>Until {new Date(project.end_date).toLocaleDateString()}</span>
          )}
        </div>
      )}
      
      <!-- Read more link -->
      <div class="flex justify-end">
        <span class="text-xs font-medium lab-accent-text flex items-center">
          View Project
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </span>
      </div>
    </div>
  </a>
</div>